\documentclass[tikz]{article}
%\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

\usepackage{geometry}
\geometry{hmargin=1cm,vmargin=1cm}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{mathtools}

%\usepackage{graphics}

\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{arrows}
\usetikzlibrary{positioning}

%%%<
\usepackage{verbatim}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}
\setlength{\PreviewBorder}{10pt}%
%%%>

% Input paths
\makeatletter
\def\input@path{{figures/}}
\makeatother

% Dimensions
% Ratio of a4paper 210 x 297 mm
\def\width{29.7}
\def\height{21.0}


\tikzset{
    x=1cm, 
    y=1cm,
    largenode/.style={rectangle,rounded corners,draw=black, top color=white, bottom color=white!50, inner sep=1em, minimum size=3em, text centered},
    smallnode/.style={rectangle,rounded corners,draw=black, top color=white, bottom color=white!50, inner sep=0.5em, minimum size=1em, text centered},
    inactive/.style={rectangle,rounded corners,draw=black, top color=white, bottom color=white!50, inner sep=1em, minimum size=3em, text centered, opacity=0.5},
    simuarrow/.style={-latex, thick},
    interactionarrow/.style={latex-latex, red},
    inputarrow/.style={-latex, gray},
    returnarrow/.style={-latex, semithick, brown},
}

%http://tex.stackexchange.com/questions/69439/how-can-i-achieve-relative-positioning-in-tikz
%http://tex.stackexchange.com/questions/160918/circular-graph-with-many-nodes
%http://tex.stackexchange.com/questions/172819/how-to-connect-relative-polar-coordinates-in-tikz
%https://en.wikipedia.org/wiki/Graph_drawing

\begin{document}
\begin{tikzpicture}
% Origin centered grid
% ------------------------------------------------------------------------------
\pgfmathsetmacro{\xoffset}{\width / 2}
\pgfmathsetmacro{\yoffset}{\height / 2}

\coordinate[] (origin) at (0, 0);

\draw[step=1cm, line width=0.1mm, black!10!white] 
($ (origin) - (\xoffset, {\yoffset - 4}) $) grid ($ (origin) + (\xoffset, {\yoffset + 4}) $);


\draw[dotted] (0:3.0) arc (0:180:3.0);
\draw[dotted] (0:5.5) arc (0:180:5.5);
\draw[dotted] (0:8.5) arc (0:180:8.5);
\draw[dotted] (0:12.5) arc (0:180:12.5);


% ------------------------------------------------------------------------------
% Struct
% ------------------------------------------------------------------------------
\node[] (struct) at (origin) {};

\def\N{4}:
\def\r{2.0};

\node[smallnode] (wall)     at ({-180/\N*0-180:2.5}) {Wall};
\node[smallnode] (agent)    at ({-180/\N*1-165:1.5}) {Agent};
\node[smallnode] (constant) at ({-180/\N*2-180:1.5}) {Constant};
\node[smallnode] (goal)     at ({-180/\N*3-195:1.5}) {Goal};
\node[smallnode] (result)   at ({-180/\N*4-180:2.5}) {Result};


% ------------------------------------------------------------------------------
% Parameters
% ------------------------------------------------------------------------------

\node[smallnode] (parameters) at ({-90:1}) {Parameters};

\path[->] (parameters) edge[bend left=45] (result);
\path[->] (parameters) edge[bend left=20] (goal);
\path[->] (parameters) edge[] (constant);
\path[->] (parameters) edge[bend right=20] (agent);
\path[->] (parameters) edge[bend right=45] (wall);

% ------------------------------------------------------------------------------
% Simulation
% ------------------------------------------------------------------------------
\def\N{6};
\def\r{5.5};

\node[inactive] (game)       at ({-180/\N*0-180:\r}) {Game};
\node[inactive] (navigation) at ({-180/\N*1-180:\r}) {Navigation};
\node[largenode] (integrator)   at ({-180/\N*2-180:\r}) {Integrator};
\node[largenode] (area)        at ({-180/\N*3-180:\r}) {Area};
\node[largenode] (save)         at ({-180/\N*4-180:\r}) {Save};
\node[largenode] (print)        at ({-180/\N*5-180:\r}) {Print};
\node[largenode] (visualize)    at ({-180/\N*6-180:\r}) {Visualize};


\path[simuarrow] (game)       edge[bend left=10] (navigation);
\path[simuarrow] (navigation) edge[bend left=10] (integrator);
\path[simuarrow] (integrator) edge[bend left=10] (area);
\path[simuarrow] (area)      edge[bend left=10] (save);
\path[simuarrow] (save)       edge[bend left=10] (print);
\path[simuarrow] (print)      edge[bend left=10] (visualize);

\path[simuarrow] (visualize)  edge[dashed, bend left=65] node[largenode, below] {Advance Simulation} (game);
%\path[simuarrow, dashed] (visualize)  edge[bend right] node[below, sloped] {End simulation} ($ (visualize) + (5, -3) $);


\path[interactionarrow] (navigation) edge[] (wall);
\path[interactionarrow] (navigation) edge[bend left=10] (agent);

\path[interactionarrow] (game)       edge[] (agent);
\path[interactionarrow] (integrator) edge[] (agent);
\path[interactionarrow] (integrator) edge[] (wall);
\path[interactionarrow] (integrator) edge[] (constant);
\path[interactionarrow] (area)      edge[] (goal);
\path[interactionarrow] (area)      edge[] (agent);


\path[inputarrow] (wall)     edge[bend left] (save);
\path[inputarrow] (agent)    edge[bend left] (save);
\path[inputarrow] (constant) edge[bend left] (save);
\path[inputarrow] (goal)     edge[bend right=10] (save);
\path[inputarrow] (result)   edge[bend right=10] (save);
\path[inputarrow] (agent)    edge[bend left=35] (print);
\path[inputarrow] (wall)     edge[bend left=65] (visualize);
\path[inputarrow] (agent)    edge[bend left=55] (visualize);
\path[inputarrow] (constant) edge[bend left=50] (visualize);
\path[inputarrow] (goal)     edge[bend left=50] (visualize);
\path[inputarrow] (result)   edge[bend left=60] (visualize);

% ------------------------------------------------------------------------------
% Area
% ------------------------------------------------------------------------------

\node[largenode] (goalhandler) at ($ (area) + (125:3) $) {Goal};
\node[inactive] (bounds)       at ($ (area) + (90:3) $) {Bounds};

\path[->] (goalhandler) edge[] (area);
\path[->] (bounds)      edge[] (area);

% ------------------------------------------------------------------------------
% Core / Integrator
% ------------------------------------------------------------------------------

\node[largenode] (motion) at ($ (integrator) + (135:3) $) {Motion};

\node[largenode] (adjust)      at ($ (motion) + (90:4) $) {Adjust};
\node[largenode] (agent-agent) at ($ (motion) + (135:4) $) {Agent-Agent};
\node[largenode] (agent-wall)  at ($ (motion) + (155:4) $) {Agent-Wall};
\node[largenode] (random)      at ($ (motion) + (180:4) $) {Random};

\path[returnarrow] (motion) edge[] (integrator);

\path[returnarrow] (adjust)      edge[] (motion);
\path[returnarrow] (agent-agent) edge[] (motion);
\path[returnarrow] (agent-wall)  edge[] (motion);
\path[returnarrow] (random)      edge[] (motion);

% ------------------------------------------------------------------------------
% Navigation
% ------------------------------------------------------------------------------

\node[inactive, left=1.0 of navigation] (astar) {Fluid flow};

\path[returnarrow] (astar) edge[] (navigation);

% ------------------------------------------------------------------------------
% Game
% ------------------------------------------------------------------------------

\node[inactive, left=1.0 of game] (strategy) {Best response strategy};
\node[inactive, left=1.0 of strategy] (clock) {Poisson clock};

\path[returnarrow] (strategy) edge[] (game);
\path[returnarrow] (clock) edge[] (strategy);

% ------------------------------------------------------------------------------
% Save
% ------------------------------------------------------------------------------

\node[largenode, above right=of save] (file) {HDF5 File};

\path[inputarrow] (save) edge[] (file);

% ------------------------------------------------------------------------------
% Visualize
% ------------------------------------------------------------------------------

\node[largenode, right=1.0 of visualize] (animation) {Animation};
\node[inactive, above right=1.0 of visualize] (gui) {GUI};

\path[inputarrow] (visualize) edge[] (animation);
\path[inputarrow] (visualize) edge[] (gui);

\end{tikzpicture}
\end{document}

