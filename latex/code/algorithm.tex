\begin{minted}[linenos, mathescape]{python}
    def relative_position(self, i, x, v):
        p_0, p_1, t_w, n_w, l_w = self.deconstruct(i)
        
        # $ \mathbf{v} = \mathbf{0} $
        if np.all(v == 0.0):
            return np.zeros(2)

        q_0 = p_0 - x
        q_1 = p_1 - x

        n_iw = -np.sign(dot2d(n_w, q_0)) * n_w

        angle = np.array((np.arctan2(q_0[0], q_0[1]),
                          np.arctan2(q_1[0], q_1[1]),
                          np.arctan2(n_iw[0], n_iw[1])))

        if abs(angle[0] - angle[1]) < 1.48e-08:  # Almost equal
            if np.hypot(q_0[0], q_0[1]) < np.hypot(q_1[0], q_1[1]):
                return q_0
            else:
                return q_1

        angle -= np.arctan2(v[0], v[1])  # Angle of velocity vector
        angle %= 2 * np.pi

        args = (np.argmin(angle), np.argmax(angle))

        if 2 in args:
            if 0 in args:
                return q_0
            else:
                return q_1
        else:
            arr = np.zeros((2, 2))
            arr[:, 0] = v
            arr[:, 1] = p_0 - p_1
            arr = np.linalg.inv(arr)
            a, _ = np.dot(arr, q_0)
            return a * v
\end{minted}
